{"version":3,"file":"_server.ts-JtoV6Gj-.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/outray/upload/_server.ts.js"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nconst BASE_URL = \"https://outraypanel-production.up.railway.app/\";\nconst FLASK_URL = \"https://pdfparser-production.up.railway.app\";\nasync function saveFile(file, uploadDir) {\n  const fileName = Math.floor(1e3 + Math.random() * 9e3) + \".pdf\";\n  const filePath = path.join(uploadDir, fileName);\n  console.log(\"Preparing to save file at:\", filePath);\n  if (!fs.existsSync(uploadDir)) {\n    console.log(\"Creating upload directory:\", uploadDir);\n    fs.mkdirSync(uploadDir, { recursive: true });\n  }\n  const buffer = Buffer.from(await file.arrayBuffer());\n  await fs.promises.writeFile(filePath, buffer);\n  try {\n    const buffer2 = Buffer.from(await file.arrayBuffer());\n    await fs.promises.writeFile(filePath, buffer2);\n    console.log(\"File saved:\", filePath);\n    await fs.promises.chmod(filePath, 511);\n    console.log(\"File permissions changed to 777:\", filePath);\n    if (fs.existsSync(filePath) && fs.statSync(filePath).size > 0) {\n      console.log(\"File verification successful:\", filePath);\n      return fileName;\n    } else {\n      console.error(\"File verification failed:\", filePath);\n      return \"null\";\n    }\n  } catch (error) {\n    console.error(\"Error saving file:\", error);\n    return \"null\";\n  }\n  return fileName;\n}\nconst POST = async ({ request }) => {\n  try {\n    console.log(\"Received file upload request\");\n    const data = await request.formData();\n    const file = data.get(\"file\");\n    if (!(file instanceof File)) {\n      console.error(\"Uploaded data is not a file\");\n      throw new Error(\"Uploaded data is not a file\");\n    }\n    if (file.type !== \"application/pdf\") {\n      console.error(\"File type is not PDF\");\n      return new Response(JSON.stringify({ error: \"Only PDF files are allowed\" }), { status: 400 });\n    }\n    const uploadDir = \"./static/\";\n    const savedFileName = await saveFile(file, uploadDir);\n    console.log(\"File saved:\", savedFileName);\n    const publicPath = `/${savedFileName}`;\n    const fullPath = `${BASE_URL}/${publicPath}`;\n    const normalizedFullPath = fullPath.replace(/([^:]\\/)\\/+/g, \"$1\");\n    console.log(\"Making API call to Flask with path:\", normalizedFullPath);\n    console.log(`${FLASK_URL}/flaskin/`);\n    const response = await fetch(`${FLASK_URL}/flaskin/`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ filePath: normalizedFullPath })\n    });\n    if (!response.ok) {\n      console.error(\"Flask API call failed\");\n      throw new Error(\"Error processing file\");\n    }\n    console.log(\"File processing by Flask API successful\");\n    console.log(\"File deleted from SvelteKit server:\", savedFileName);\n    return new Response(JSON.stringify({ fullPath }), { status: 200 });\n  } catch (error) {\n    console.error(\"Error in file processing:\", error);\n    return new Response(\n      JSON.stringify({ error: \"Error processing file\", details: error.message }),\n      { status: 500 }\n    );\n  }\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}