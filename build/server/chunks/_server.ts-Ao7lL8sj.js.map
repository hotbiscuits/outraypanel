{"version":3,"file":"_server.ts-Ao7lL8sj.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/outray/csvprocess/_server.ts.js"],"sourcesContent":["import Papa from \"papaparse\";\nfunction processData(originalData, date) {\n  console.log(originalData);\n  console.log(date);\n  const newHeadings = [\n    \"manifest_reference\",\n    \"consignment_reference\",\n    \"pickup_name\",\n    \"pickup_street\",\n    \"pickup_suburb\",\n    \"pickup_postcode\",\n    \"pickup_state\",\n    \"pickup_telephone\",\n    \"consignment_value\",\n    \"delivery_name\",\n    \"delivery_street\",\n    \"delivery_suburb\",\n    \"delivery_postcode\",\n    \"delivery_state\",\n    \"delivery_telephone\",\n    \"cod\",\n    \"special_instructions\",\n    \"type\",\n    \"required_delivery_date\",\n    \"item_code\",\n    \"description\",\n    \"qty_item\",\n    \"pal_item\",\n    \"cubic_item\",\n    \"weight_item\",\n    \"space_item\",\n    \"length_item\",\n    \"width_item\",\n    \"height_item\",\n    \"Service Type\"\n  ];\n  const originalToNewHeadingsMap = {\n    Consignment: \"consignment_reference\",\n    \"Venue name\": \"delivery_name\",\n    Address: \"delivery_street\",\n    Suburb: \"delivery_suburb\",\n    State: \"delivery_state\",\n    Postcode: \"delivery_postcode\",\n    Phone: \"delivery_telephone\",\n    Instructions: \"special_instructions\",\n    Type: \"type\",\n    Weight: \"weight_item\",\n    Items: \"qty_item\"\n    // Assuming 'Items' maps to 'qty_item'\n    // ... add other mappings if necessary\n  };\n  let processedData = originalData.slice(1).map((row) => {\n    let newRow = new Array(newHeadings.length).fill(\"\");\n    Object.entries(originalToNewHeadingsMap).forEach(([oldHeading, newHeading]) => {\n      const originalIndex = originalData[0].indexOf(oldHeading);\n      if (originalIndex !== -1) {\n        const newHeadingIndex = newHeadings.indexOf(newHeading);\n        newRow[newHeadingIndex] = row[originalIndex];\n      }\n    });\n    newRow[newHeadings.indexOf(\"pickup_name\")] = \"Outrayjus Warehousing and Distribution\";\n    newRow[newHeadings.indexOf(\"pickup_street\")] = \"33 Riverside Place\";\n    newRow[newHeadings.indexOf(\"pickup_suburb\")] = \"Morningside\";\n    newRow[newHeadings.indexOf(\"pickup_state\")] = \"QLD\";\n    newRow[newHeadings.indexOf(\"pickup_postcode\")] = \"4170\";\n    newRow[newHeadings.indexOf(\"required_delivery_date\")] = date;\n    newRow[newHeadings.indexOf(\"item_code\")] = \"CAR\";\n    newRow[newHeadings.indexOf(\"description\")] = \"carton\";\n    newRow[newHeadings.indexOf(\"Service Type\")] = row[originalData[0].indexOf(\"Type\")] === \"Pickup\" ? \"Pick up - next day\" : \"General\";\n    newRow[newHeadings.indexOf(\"qty_item\")] = row[originalData[0].indexOf(\"Items\")];\n    return newRow;\n  });\n  return [newHeadings, ...processedData];\n}\nasync function POST({ request }) {\n  try {\n    const requestBody = await request.json();\n    const { tableData, dateString } = requestBody;\n    const processedData = processData(tableData, dateString);\n    const csv = Papa.unparse(processedData);\n    const bodyStream = new ReadableStream({\n      start(controller) {\n        controller.enqueue(new TextEncoder().encode(csv));\n        controller.close();\n      }\n    });\n    const headers = new Headers();\n    headers.append(\"Content-Type\", \"text/csv\");\n    headers.append(\"Content-Disposition\", 'attachment; filename=\"processed_data.csv\"');\n    return new Response(bodyStream, {\n      status: 200,\n      // OK status\n      headers\n    });\n  } catch (error) {\n    console.error(\"Error processing request:\", error);\n    return new Response(\"Internal Server Error: \" + error.message, {\n      status: 500,\n      headers: new Headers({ \"Content-Type\": \"text/plain\" })\n    });\n  }\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}