{"version":3,"file":"_server-uFSdNifi.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/files/_server.js"],"sourcesContent":["import fs from \"node:fs\";\nimport path from \"node:path\";\nimport { Readable } from \"node:stream\";\nconst uploadsDir = \"/uploads/\";\nif (!fs.existsSync(uploadsDir)) {\n  fs.mkdirSync(uploadsDir, { recursive: true });\n}\nasync function GET({ params, request }) {\n  const file_path = path.normalize(path.join(uploadsDir, params.name));\n  if (!fs.existsSync(file_path)) {\n    return new Response(`File not found not a teapot: ${params.name}`, { status: 418 });\n  }\n  const stats = fs.statSync(file_path);\n  const etag = `W/\"${stats.size}-${stats.mtime.getTime()}\"`;\n  if (request.headers.get(\"if-none-match\") === etag) {\n    return new Response(null, { status: 304 });\n  }\n  const headers = {\n    ETag: etag,\n    \"Content-Type\": mimes.lookup(file_path),\n    \"Content-Length\": stats.size,\n    \"Cache-Control\": \"max-age=60\",\n    \"Last-Modified\": stats.mtime.toUTCString()\n  };\n  const nodejs_rstream = fs.createReadStream(file_path);\n  const web_rstream = Readable.toWeb(nodejs_rstream, {\n    strategy: new CountQueuingStrategy({ highWaterMark: 100 })\n  });\n  return new Response(web_rstream, { headers });\n}\nconst mimes = {\n  // Text\n  txt: \"text/plain\",\n  pdf: \"application/pdf\",\n  // Images\n  webp: \"image/webp\",\n  png: \"image/png\",\n  jpg: \"image/jpeg\",\n  jpeg: \"image/jpeg\",\n  avif: \"image/avif\",\n  // Audio\n  mp3: \"audio/mp3\",\n  // Video\n  webm: \"video/webm\",\n  mp4: \"video/mp4\",\n  /** @param {string} string */\n  lookup(string) {\n    const ext = string.toLowerCase().split(\".\").at(-1);\n    return (ext && this[\n      /** @type {keyof typeof mimes} */\n      ext\n    ]) ?? \"application/octet-stream\";\n  }\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;AAGA,MAAM,UAAU,GAAG,WAAW,CAAC;AAC/B,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,UAAU,CAAC,EAAE;AAChC,EAAE,EAAE,CAAC,SAAS,CAAC,UAAU,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;AAChD,CAAC;AACD,eAAe,GAAG,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE;AACxC,EAAE,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;AACvE,EAAE,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE;AACjC,IAAI,OAAO,IAAI,QAAQ,CAAC,CAAC,6BAA6B,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC;AACxF,GAAG;AACH,EAAE,MAAM,KAAK,GAAG,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;AACvC,EAAE,MAAM,IAAI,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC,EAAE,KAAK,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,CAAC;AAC5D,EAAE,IAAI,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,KAAK,IAAI,EAAE;AACrD,IAAI,OAAO,IAAI,QAAQ,CAAC,IAAI,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC;AAC/C,GAAG;AACH,EAAE,MAAM,OAAO,GAAG;AAClB,IAAI,IAAI,EAAE,IAAI;AACd,IAAI,cAAc,EAAE,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC;AAC3C,IAAI,gBAAgB,EAAE,KAAK,CAAC,IAAI;AAChC,IAAI,eAAe,EAAE,YAAY;AACjC,IAAI,eAAe,EAAE,KAAK,CAAC,KAAK,CAAC,WAAW,EAAE;AAC9C,GAAG,CAAC;AACJ,EAAE,MAAM,cAAc,GAAG,EAAE,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC;AACxD,EAAE,MAAM,WAAW,GAAG,QAAQ,CAAC,KAAK,CAAC,cAAc,EAAE;AACrD,IAAI,QAAQ,EAAE,IAAI,oBAAoB,CAAC,EAAE,aAAa,EAAE,GAAG,EAAE,CAAC;AAC9D,GAAG,CAAC,CAAC;AACL,EAAE,OAAO,IAAI,QAAQ,CAAC,WAAW,EAAE,EAAE,OAAO,EAAE,CAAC,CAAC;AAChD,CAAC;AACD,MAAM,KAAK,GAAG;AACd;AACA,EAAE,GAAG,EAAE,YAAY;AACnB,EAAE,GAAG,EAAE,iBAAiB;AACxB;AACA,EAAE,IAAI,EAAE,YAAY;AACpB,EAAE,GAAG,EAAE,WAAW;AAClB,EAAE,GAAG,EAAE,YAAY;AACnB,EAAE,IAAI,EAAE,YAAY;AACpB,EAAE,IAAI,EAAE,YAAY;AACpB;AACA,EAAE,GAAG,EAAE,WAAW;AAClB;AACA,EAAE,IAAI,EAAE,YAAY;AACpB,EAAE,GAAG,EAAE,WAAW;AAClB;AACA,EAAE,MAAM,CAAC,MAAM,EAAE;AACjB,IAAI,MAAM,GAAG,GAAG,MAAM,CAAC,WAAW,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AACvD,IAAI,OAAO,CAAC,GAAG,IAAI,IAAI;AACvB;AACA,MAAM,GAAG;AACT,KAAK,KAAK,0BAA0B,CAAC;AACrC,GAAG;AACH,CAAC;;;;"}